<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>波浪微博</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href='stylesheets/bootstrap-3.3.7/css/bootstrap.min.css'>
    <link rel="stylesheet" href='fonts/iconfont.css'>
    <link rel="stylesheet" href='stylesheets/musicprogress.css'>
    <script src='javascripts/jquery-3.1.0.min.js'></script>
    <script src='javascripts/bootstrap.min.js'></script>
    <style>
        body{
            font-family: "微软雅黑";
        }
        .musictable,.tablemusic,span,label{
            color: white;
        }
        @font-face {
            font-family: 'iconfont';
            src: url('../public/fonts/iconfont.eot');
            src: url('../public/fonts/iconfont.eot?#iefix') format('embedded-opentype'),
            url('../public/fonts/iconfont.woff') format('woff'),
            url('../public/fonts/iconfont.ttf') format('truetype'),
            url('../public/fonts/iconfont.svg#iconfont') format('svg');
        }
        .iconfont{
            font-family:"iconfont" !important;
            cursor: pointer;
            font-size:32px;font-style:normal;
            color: #28a4c9;
            -webkit-font-smoothing: antialiased;
            -webkit-text-stroke-width: 0.2px;
            -moz-osx-font-smoothing: grayscale;
        }

    </style>
</head>
<body>
<div class="navbar navbar-fixed-top navbar-inverse" role="navigation" style="border-bottom: hidden">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#" >波浪微博</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/allfunction" ><span class="glyphicon glyphicon-home"></span> 主界面</a></li>
                <li ><a href="#" onclick="webblog()" ><span class="glyphicon glyphicon-pencil"></span> 微博</a></li>
                <li ><a href="#" onclick="webmusic()"><span class="glyphicon glyphicon-headphones"></span> 音乐</a></li>
                <li><a href="/webfriend" ><span class="glyphicon glyphicon glyphicon-user"></span> 大众圈</a></li>
            </ul>
            <ul class="nav navbar-nav pull-right">
                <div class="dropdown">
                    <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" style="background: transparent;color: white;">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1" href="/personmessage" onclick="showpersonmessage()">个人信息</a>
                        </li>
                        <li role="presentation" class="divider"></li>
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1" href="/">退出登陆</a>
                        </li>
                    </ul>
                </div>
            </ul>
        </div>
        <div style="height: 82px;border: 1px solid snow; margin-top:10px;width: 1126px;position: absolute;top:462px;"id="playmusicview" >
            <div style="float: left">
                <img src=""style="width:80px;height: 80px;margin-right: 10px;" id="musicpicture">
            </div>
            <div style="float: left">
                <h4 style="color: snow;margin-top: 15px;width: 90px;"><b id="showmusictitle"></b></h4>
                <h6 style="color:snow;width: 70px;"id="showsinger"></h6>
            </div>
            <div style="float: left;margin: 12px 0px 0px 20px; ">
                <i class="iconfont" style="vertical-align:middle;position: absolute;z-index: 3;left:220px;bottom:18px"id="prev" >&#xe611;</i><i class="iconfont" style="vertical-align:middle;position: absolute;font-size:42px;z-index: 3;left:275px;bottom: 13px"id="play" >&#xe614;</i><i class="iconfont"style="vertical-align:middle;position: absolute;z-index: 3;left:337px;bottom:18px"id="next" >&#xe61b;</i>
            </div>
            <div style="float: left;margin:27px 0px 0px 200px;"><span id="current-time" style="font-size: 11px;" >0:00</span></div>
            <div class="progressmusic"   >
				<span id="music-bar">
					<span id="played-bar"></span>
				</span>
				<span id="voice-bar">
					<span id="voiced-bar"></span>
				</span>
            </div>
            <div style="float: left;margin:27px 0px 0px 455px"><span id="total-time" style="font-size: 11px">0:00</span> </div>
            <div style="float: left;margin:27px 0px 0px 8px ">
                <i class="iconfont" style="vertical-align:middle;font-size:14px;color:snow;position: absolute;bottom: 31px;"id="novoice">&#xe610;</i>
            </div>
            <div style="float: left;margin: 27px 0px 0px 130px ">
                <i class="iconfont" style="vertical-align:middle;font-size:14px;color:snow;" id="musicmode">&#xe608;</i>
            </div>
            <div style="float: left;margin: 27px 0px 0px 10px ">
                <i class="iconfont" style="vertical-align:middle;font-size:14px;color:snow"onclick="showlistall()">&#xe617;</i>
            </div>
            <audio id="audio" controls="controls" hidden="hidden" src=""></audio>
            <input value="0" id="musicmodemark" hidden="hidden">
            <input value="" id="prevmark" hidden="hidden">
            <input value="" id="nowmusicmark" hidden="hidden">
        </div>
    </div>
    </div>
</div>
<div id="bolangblog" hidden="hidden"  >
    <iframe MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no src="/webblog" width="100%"  height="601px"></iframe>
</div>
<div id="bolangmusic" >
    <iframe MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no src="/webmusic" width="100%"  height="601px" id="bolangmusicdiv"></iframe>
</div>
<script>
    var audioparent = document.getElementById('audio'),
            voiceBar = document.getElementById('voice-bar'),
            musicBar = document.getElementById('music-bar'),
            playedBar = document.getElementById('played-bar'),
            voicedBar = document.getElementById('voiced-bar'),
            currentTime = document.getElementById('current-time'),
            totalTimeparent = document.getElementById('total-time'),
            playparent = document.getElementById('play'),
            prevparent = document.getElementById('prev'),
            nextparent = document.getElementById('next'),
            novoice=document.getElementById('novoice'),
            musicmode = document.getElementById('musicmode'),
            musicmodemark=document.getElementById('musicmodemark'),
            nowmusicmark=document.getElementById('nowmusicmark'),
            prevmark=document.getElementById('prevmark'),
            bolangmusic=document.getElementById('bolangmusic'),
            showmusictitleparent=$('#showmusictitle'),
            showsingerparent=$('#showsinger');
            showpictureparent=$('#musicpicture');
    $(document).ready(function () {
        $("#myCarousel").carousel({interval:2000});
        $("#upfile").change(function() {
            $('#photoCover').val($(this).val());
        });
        $.ajax({
            type:'post',
            url:'/blogname',
            dataType:'json',
            success:function (msg) {
                var result=eval(msg);
                var nickname=result.nickname;
                $("#dropdownMenu1").html("欢迎您,"+nickname+"<span class='caret'></span>");
            }
        });
        audioparent.loop = true;
        audioparent.autoplay = false;
        audioparent.volume = 0.5;
        var voicedBarWidth = (audioparent.volume / 1) * voiceBar.clientWidth;
        voicedBar.style.width = voicedBarWidth + 'px';
        audioparent.autobuffer = false;
        voiceBar.onclick = function (event) {
            var voiceBarWidth = voiceBar.clientWidth;
            var newVolume = (event.offsetX / voiceBarWidth);
            audioparent.volume = newVolume;


            var voicedBarWidth = (audioparent.volume / 1) * voiceBarWidth;
            voicedBar.style.width = voicedBarWidth + 'px';

        };

        musicBar.onclick = function (event) {
            var musicBarWidth = musicBar.clientWidth;
            var newCurrentTime = (event.offsetX / musicBarWidth) * audioparent.duration;
            audioparent.currentTime = newCurrentTime;
            var playedBarWidth = (audioparent.currentTime / audioparent.duration) * musicBarWidth;
            playedBar.style.width = playedBarWidth + 'px';
        };

        // 播放进度实时更新(修改为歌曲播放时开启定时器，暂停和页面load时清除定时器)
        setInterval(function updatePlayedBar() {
            var musicBarWidth = musicBar.clientWidth;
            var playedBarWidth = (audioparent.currentTime / audioparent.duration) * musicBarWidth;
            playedBar.style.width = playedBarWidth + 'px';
            if (audioparent.currentTime % 60 < 10) {
                currentTime.innerHTML = parseInt(audioparent.currentTime / 60) + ':0' + parseInt(audioparent.currentTime % 60);
            } else {
                currentTime.innerHTML = parseInt(audioparent.currentTime / 60) + ':' + parseInt(audioparent.currentTime % 60);
            }
            if (audioparent.currentTime === audioparent.duration && !audioparent.loop) {
                next.onclick();
            }
        }, 500);

        novoice.onclick=function () {
            if (!audioparent.muted) {
                audioparent.muted = true;
                voicedBar.style.width = 0 +'px';
                novoice.innerHTML='&#xe60d;';
            }else {
                novoice.innerHTML='&#xe610;';
                audioparent.muted = false;
                var voiceBarWidth = voiceBar.clientWidth;
                var voicedBarWidth = (audioparent.volume / 1) * voiceBarWidth;
                voicedBar.style.width = voicedBarWidth + 'px';
            }
        }
        musicmode.onclick=function () {
            alert(musicmodemark.value);
           if(musicmodemark.value=="0"){
                audioparent.loop=false;
                musicmode.innerHTML='&#xe60e;'
               musicmodemark.value="1";
            }
            else if(musicmodemark.value=="1"){
                audioparent.loop=false;
                musicmode.innerHTML='&#xe612;'
               musicmodemark.value="2";
            }
            else{
               audioparent.loop=true;
               musicmode.innerHTML='&#xe608;'
               musicmodemark.value="0";
           }
        }

    })
    function  webblog() {

        $("#bolangblog").show();
        $("#bolangmusic").hide();
        $("#playmusicview").hide();
    }
    function webmusic() {
        $("#bolangblog").hide();
        $("#bolangmusic").show();
        $("#playmusicview").show();
    }
    function  showlistall() {
        $("#bolangmusicdiv").contents().find("#musicdiv").toggle();
    }



</script>

</body>
</html>